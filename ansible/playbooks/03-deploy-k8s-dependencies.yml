---
  - hosts: all
    become: true
    remote_user: devops
    tasks:
    - name: "MOUNT - Remove swapfile from /etc/fstab"
      mount:
        name: ["swap", "none"]
        fstype: swap
        state: absent

    - name: "CMD - Disable swap"
      command: swapoff -a
      when: ansible_swaptotal_mb > 0

    - name: "APT - Add an apt signing key for Kubernetes"
      apt_key:
        url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
        state: present
    
    - name: "APT - Adding apt repository for Kubernetes"
      apt_repository:
        repo: "deb https://apt.kubernetes.io/ kubernetes-xenial main"
        state: present
        filename: kubernetes.list

    - name: "APT - Install Kubernetes binaries"
      apt:
        name: ["kubelet=1.15.0-00", "kubeadm=1.15.0-00"]
        state: present
        update_cache: true

  - hosts: #master
    become: yes
    remote_user: devops
    tasks:
      - name: "APT - Install Kubernetes CTL binaries"
        apt:
          name: kubectl=1.15.0-00
          state: present
          force: yes      
